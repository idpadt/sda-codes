{% extends 'base.html' %}

{% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Button for form modal -->
<button type="button" class="btn btn-outline-light position-fixed bottom-0 end-0 mb-3 me-3 fs-5" data-bs-toggle="modal" data-bs-target="#form_modal">
    New Note
</button>


<!-- Dummy button -->
<a href="{% url 'catatanku:big_boi' %}">
    <button>
        Transaksi Baru
    </button>
</a>

<!-- Form Modal -->
<div class="modal fade" id="form_modal" data-bs-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content rounded-3 shadow">
            <div class="modal-header border-bottom-1 mx-3 pb-1">
                <div class="h4">New Note</div>
                <button type="button" class=" btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body mx-3 border-bottom-0">
                <!--<form method="POST">-->
                    {% csrf_token %}
                    <div class="mb-0">
                        <label for="title" class="col-form-label">Title:</label>
                        <input type="text" class="form-control" id="title" name="title"></input>
                    </div>
                    <div class="mb-0">
                        <label for="description" class="col-form-label">Desctiption:</label>
                        <textarea class="form-control" id="description" name="description"></textarea>
                    </div>
                <!--</form>-->
            </div>
            <div class="modal-footer mx-3 border-top-0">
                <button type="submit" class="btn btn-outline-light" id="add_note" data-bs-dismiss="modal">Add note</button>
            </div>
        </div>
    </div>
</div>

<header class="container text-center py-3 border-bottom" >
    <div class="row">
        <div class="col">
            <div class="h2">Catatanku!</div>
        </div>
    </div>
</header>

<main class="container mt-4" id="list_of_notes"></main>

<script>
    $(document).ready(function(){
        $.get("/json/", function(data) {
            for (ii=0; ii<data.length; ii++){
                $('#list_of_notes').append(`
                <div id="${data[ii].pk}--task" class="col-md-6 col-lg-3 mb-3">
                    <div class="card d-flex">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">${data[ii].fields.title}</h5>
                            <p class="card-text">${data[ii].fields.description}</p>
                            <p class="card-text">${data[ii].fields.date}</p>
                            <p class="card-text">${data[ii].fields.time}</p>
                            <div class="mt-auto">
                                <a href="/tracker/delete/${data[ii].pk}" class="btn btn-primary delete mb-2">Hapus</a>
                                <a href="/tracker/modify/${data[ii].pk}" class="btn btn-secondary mb-2">Ubah</a>
                            </div>
                        </div>
                    </div>
                </div>
                `)
            }
        });

        $("#add_note").click(function(){
            $.post("/create/", {
                title: $("#title").val(),
                description: $("#description").val(),
            },
            function(result, status){
                console.log(status)
                if (status == 'success'){
                    $("#list_of_notes").append(`
                    <div id="${result.id}--task" class="col-md-6 col-lg-3 mb-3">
                        <div class="card d-flex">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${result.title}</h5>
                                <p class="card-text">${result.description}</p>
                                <p class="card-text">${result.date}</p>
                                <p class="card-text">${result.time}</p>
                                <div class="mt-auto">
                                    <a href="/tracker/delete/${result.id}" class="btn btn-primary delete mb-2">Hapus</a>
                                    <a href="/tracker/modify/${result.id}" class="btn btn-secondary mb-2">Ubah</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    `);
                $('#title').val('')
                $('#description').val('')
                }
            })
        })
    })
</script>

{% endblock content %}